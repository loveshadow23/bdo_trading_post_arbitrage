<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BDO Item Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #1b1c1d; color: #eee; }
        img { max-height: 48px; vertical-align: middle; }
        .market-section { margin-bottom: 2em; }
        .bidding-table, .market-table { border-collapse: collapse; margin-top: 1em;}
        .bidding-table th, .bidding-table td,
        .market-table th, .market-table td { border: 1px solid #ccc; padding: 4px 8px; }
        a { color: #aee; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1><a href="{{ url_for('index') }}" style="color:inherit; text-decoration:none;">BDO Item Search</a></h1>
    <form method="post" action="{{ url_for('index') }}">
        <input type="text" name="query" value="{{ query }}" placeholder="Item name or ID" required>
        <button type="submit">Search</button>
    </form>
    {% if results == "not_found" %}
        <p style="color:red;">Item not found!</p>
    {% elif results %}
        <h2>Results:</h2>
        <ul>
        {% for item in results %}
            <li>
                <a href="{{ url_for('item_detail', item_id=item.id) }}">
                    {% if item.image %}
                        <img src="{{ item.image }}" alt="icon">
                    {% endif %}
                    {{ item.name }} (ID: {{ item.id }})
                </a>
            </li>
        {% endfor %}
        </ul>
    {% elif details %}
        <h2>{{ details.name }} (ID: {{ details.id }})</h2>
        {% if details.image %}
            <img src="{{ details.image }}" alt="icon">
        {% endif %}
        {% for item in details.market_data %}
        <div class="market-section">
            <h3>
                Enhancement: {{ item.enhancement_min|enh_name(item.enhancement_max, details.id) }}
            </h3>
            <table class="market-table">
                <tr>
                    <th>Base Price</th>
                    <th>Current Stock</th>
                    <th>Total Trades</th>
                    <th>Price Min</th>
                    <th>Price Max</th>
                    <th>Last Sale Price</th>
                    <th>Last Sale Time (RO)</th>
                </tr>
                <tr>
                    <td>{{ item.base_price|format_number }}</td>
                    <td>{{ item.current_stock|format_number }}</td>
                    <td>{{ item.total_trades|format_number }}</td>
                    <td>{{ item.price_hardcap_min|format_number }}</td>
                    <td>{{ item.price_hardcap_max|format_number }}</td>
                    <td>{{ item.last_sale_price|format_number }}</td>
                    <td>{{ item.last_sale_time_ro }}</td>
                </tr>
            </table>
            {% if item.bidding_info %}
                <h4>Bidding Info</h4>
                <table class="bidding-table">
                    <tr>
                        <th>Sellers</th>
                        <th>Price</th>
                        <th>Buyers</th>
                    </tr>
                    {% for bid in item.bidding_info %}
                    <tr>
                        <td>{{ bid.sell_orders|format_number }}</td>
                        <td>{{ bid.price|format_number }}</td>
                        <td>{{ bid.buy_orders|format_number }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </div>
        {% endfor %}
    {% elif enh_list %}
    <h2>Enhancements for "{{ query }}"</h2>
    <ul>
    {% for enh in enh_list %}
        <li>
            <a href="{{ url_for('item_detail_enh', item_id=enh.id, enh_min=enh.enhancement_min, enh_max=enh.enhancement_max) }}">
                {% if enh.image %}
                    <img src="{{ enh.image }}" alt="icon">
                {% endif %}
                {{ enh.enhancement_min|enh_name(enh.enhancement_max, enh.id) }} {{ enh.name }}
            </a>
        </li>
    {% endfor %}
    </ul>
    {% endif %}
</body>
</html>
